<!DOCTYPE html>
<html>
  <head>
    <title>FIW Video Triplets</title>  <!-- CHANGE THIS (title) -->
      
    <script src="https://unpkg.com/jspsych@7.2.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-button-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-select@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-call-function@1.1.0"></script>
    <script src="jquery-3.5.1.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.0"></script>
    <link href="https://unpkg.com/jspsych@7.2.1/css/jspsych.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/@jspsych/plugin-video-button-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-video-keyboard-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>



      
  </head>
  <body></body>
    
  <script>
      
      

    var jsPsych = initJsPsych({
        show_progress_bar:false,
        on_data_update: function(){
            jsPsych.data.addProperties({worker_id: urlvar.workerId});
            //saveData(file, jsPsych.data.get().csv());
            save_data;
        },
        on_finish: function(){
            jsPsych.data.addProperties({worker_id: urlvar.workerId});
            //saveData(file, jsPsych.data.get().csv());
            save_data;

        },
        max_load_time: 120000
    });

      var secret_code  = jsPsych.randomization.randomID(8);
      var file_name = "fiw_triplets_" + secret_code; // CHANGE THIS (file name)

    // this is to save to OSF using DataPipe
      var save_data = {
        type: jsPsychPipe,
        action: "save",
        experiment_id: "7ukPnltATLAH",
        filename: file_name,
        data_string: ()=>jsPsych.data.get().csv()
      };

          /* create timeline */
    var timeline = [];
      
    // pulling info re: mechanical turk hit
      var urlvar = jsPsych.data.urlVariables();  
      
    
    var preload = {
        type: jsPsychPreload,
        auto_preload: true,
        video: [
          'resources/1.png',
'resources/10.png',
'resources/100.png',
'resources/101.png',
'resources/102.png',
'resources/104.png',
'resources/108.png',
'resources/109.png',
'resources/11.png',
'resources/110.png',
'resources/111.png',
'resources/112.png',
'resources/113.png',
'resources/114.png',
'resources/115.png',
'resources/116.png',
'resources/117.png',
'resources/118.png',
'resources/119.png',
'resources/12.png',
'resources/120.png',
'resources/13.png',
'resources/131.png',
'resources/134.png',
'resources/14.png',
'resources/143.png',
'resources/147.png',
'resources/15.png',
'resources/157.png',
'resources/16.png',
'resources/163.png',
'resources/164.png',
'resources/169.png',
'resources/17.png',
'resources/173.png',
'resources/18.png',
'resources/182.png',
'resources/183.png',
'resources/186.png',
'resources/187.png',
'resources/19.png',
'resources/2.png',
'resources/20.png',
'resources/204.png',
'resources/21.png',
'resources/22.png',
'resources/23.png',
'resources/24.png',
'resources/25.png',
'resources/26.png',
'resources/261.png',
'resources/264.png',
'resources/27.png',
'resources/28.png',
'resources/29.png',
'resources/3.png',
'resources/30.png',
'resources/31.png',
'resources/32.png',
'resources/33.png',
'resources/34.png',
'resources/35.png',
'resources/36.png',
'resources/37.png',
'resources/39.png',
'resources/4.png',
'resources/40.png',
'resources/41.png',
'resources/42.png',
'resources/44.png',
'resources/45.png',
'resources/46.png',
'resources/47.png',
'resources/48.png',
'resources/49.png',
'resources/5.png',
'resources/50.png',
'resources/501.png',
'resources/51.png',
'resources/52.png',
'resources/53.png',
'resources/54.png',
'resources/55.png',
'resources/56.png',
'resources/57.png',
'resources/58.png',
'resources/59.png',
'resources/6.png',
'resources/60.png',
'resources/61.png',
'resources/62.png',
'resources/63.png',
'resources/64.png',
'resources/65.png',
'resources/66.png',
'resources/67.png',
'resources/68.png',
'resources/69.png',
'resources/7.png',
'resources/70.png',
'resources/71.png',
'resources/72.png',
'resources/73.png',
'resources/74.png',
'resources/75.png',
'resources/76.png',
'resources/77.png',
'resources/78.png',
'resources/79.png',
'resources/8.png',
'resources/80.png',
'resources/81.png',
'resources/82.png',
'resources/83.png',
'resources/84.png',
'resources/85.png',
'resources/86.png',
'resources/87.png',
'resources/88.png',
'resources/89.png',
'resources/9.png',
'resources/90.png',
'resources/91.png',
'resources/92.png',
'resources/93.png',
'resources/94.png',
'resources/95.png',
'resources/96.png',
'resources/97.png',
'resources/98.png'                ],
        show_progress_bar: true,
        message: "Loading experiment files...",
        error_message: "Oops! There's a problem loading files. Please refresh the page to try again."
    }  
    timeline.push(preload);
    

      
    var faces = [

      {item: 'resources/1.png'},
{item: 'resources/10.png'},
{item: 'resources/100.png'},
{item: 'resources/101.png'},
{item: 'resources/102.png'},
{item: 'resources/104.png'},
{item: 'resources/108.png'},
{item: 'resources/109.png'},
{item: 'resources/11.png'},
{item: 'resources/110.png'},
{item: 'resources/111.png'},
{item: 'resources/112.png'},
{item: 'resources/113.png'},
{item: 'resources/114.png'},
{item: 'resources/115.png'},
{item: 'resources/116.png'},
{item: 'resources/117.png'},
{item: 'resources/118.png'},
{item: 'resources/119.png'},
{item: 'resources/12.png'},
{item: 'resources/120.png'},
{item: 'resources/13.png'},
{item: 'resources/131.png'},
{item: 'resources/134.png'},
{item: 'resources/14.png'},
{item: 'resources/143.png'},
{item: 'resources/147.png'},
{item: 'resources/15.png'},
{item: 'resources/157.png'},
{item: 'resources/16.png'},
{item: 'resources/163.png'},
{item: 'resources/164.png'},
{item: 'resources/169.png'},
{item: 'resources/17.png'},
{item: 'resources/173.png'},
{item: 'resources/18.png'},
{item: 'resources/182.png'},
{item: 'resources/183.png'},
{item: 'resources/186.png'},
{item: 'resources/187.png'},
{item: 'resources/19.png'},
{item: 'resources/2.png'},
{item: 'resources/20.png'},
{item: 'resources/204.png'},
{item: 'resources/21.png'},
{item: 'resources/22.png'},
{item: 'resources/23.png'},
{item: 'resources/24.png'},
{item: 'resources/25.png'},
{item: 'resources/26.png'},
{item: 'resources/261.png'},
{item: 'resources/264.png'},
{item: 'resources/27.png'},
{item: 'resources/28.png'},
{item: 'resources/29.png'},
{item: 'resources/3.png'},
{item: 'resources/30.png'},
{item: 'resources/31.png'},
{item: 'resources/32.png'},
{item: 'resources/33.png'},
{item: 'resources/34.png'},
{item: 'resources/35.png'},
{item: 'resources/36.png'},
{item: 'resources/37.png'},
{item: 'resources/39.png'},
{item: 'resources/4.png'},
{item: 'resources/40.png'},
{item: 'resources/41.png'},
{item: 'resources/42.png'},
{item: 'resources/44.png'},
{item: 'resources/45.png'},
{item: 'resources/46.png'},
{item: 'resources/47.png'},
{item: 'resources/48.png'},
{item: 'resources/49.png'},
{item: 'resources/5.png'},
{item: 'resources/50.png'},
{item: 'resources/501.png'},
{item: 'resources/51.png'},
{item: 'resources/52.png'},
{item: 'resources/53.png'},
{item: 'resources/54.png'},
{item: 'resources/55.png'},
{item: 'resources/56.png'},
{item: 'resources/57.png'},
{item: 'resources/58.png'},
{item: 'resources/59.png'},
{item: 'resources/6.png'},
{item: 'resources/60.png'},
{item: 'resources/61.png'},
{item: 'resources/62.png'},
{item: 'resources/63.png'},
{item: 'resources/64.png'},
{item: 'resources/65.png'},
{item: 'resources/66.png'},
{item: 'resources/67.png'},
{item: 'resources/68.png'},
{item: 'resources/69.png'},
{item: 'resources/7.png'},
{item: 'resources/70.png'},
{item: 'resources/71.png'},
{item: 'resources/72.png'},
{item: 'resources/73.png'},
{item: 'resources/74.png'},
{item: 'resources/75.png'},
{item: 'resources/76.png'},
{item: 'resources/77.png'},
{item: 'resources/78.png'},
{item: 'resources/79.png'},
{item: 'resources/8.png'},
{item: 'resources/80.png'},
{item: 'resources/81.png'},
{item: 'resources/82.png'},
{item: 'resources/83.png'},
{item: 'resources/84.png'},
{item: 'resources/85.png'},
{item: 'resources/86.png'},
{item: 'resources/87.png'},
{item: 'resources/88.png'},
{item: 'resources/89.png'},
{item: 'resources/9.png'},
{item: 'resources/90.png'},
{item: 'resources/91.png'},
{item: 'resources/92.png'},
{item: 'resources/93.png'},
{item: 'resources/94.png'},
{item: 'resources/95.png'},
{item: 'resources/96.png'},
{item: 'resources/97.png'},
{item: 'resources/98.png'}    ];
      
      //using this array instead of the named variable array above in order to work with custom functions
      var faces_arr = [
        'resources/1.png',
'resources/10.png',
'resources/100.png',
'resources/101.png',
'resources/102.png',
'resources/104.png',
'resources/108.png',
'resources/109.png',
'resources/11.png',
'resources/110.png',
'resources/111.png',
'resources/112.png',
'resources/113.png',
'resources/114.png',
'resources/115.png',
'resources/116.png',
'resources/117.png',
'resources/118.png',
'resources/119.png',
'resources/12.png',
'resources/120.png',
'resources/13.png',
'resources/131.png',
'resources/134.png',
'resources/14.png',
'resources/143.png',
'resources/147.png',
'resources/15.png',
'resources/157.png',
'resources/16.png',
'resources/163.png',
'resources/164.png',
'resources/169.png',
'resources/17.png',
'resources/173.png',
'resources/18.png',
'resources/182.png',
'resources/183.png',
'resources/186.png',
'resources/187.png',
'resources/19.png',
'resources/2.png',
'resources/20.png',
'resources/204.png',
'resources/21.png',
'resources/22.png',
'resources/23.png',
'resources/24.png',
'resources/25.png',
'resources/26.png',
'resources/261.png',
'resources/264.png',
'resources/27.png',
'resources/28.png',
'resources/29.png',
'resources/3.png',
'resources/30.png',
'resources/31.png',
'resources/32.png',
'resources/33.png',
'resources/34.png',
'resources/35.png',
'resources/36.png',
'resources/37.png',
'resources/39.png',
'resources/4.png',
'resources/40.png',
'resources/41.png',
'resources/42.png',
'resources/44.png',
'resources/45.png',
'resources/46.png',
'resources/47.png',
'resources/48.png',
'resources/49.png',
'resources/5.png',
'resources/50.png',
'resources/501.png',
'resources/51.png',
'resources/52.png',
'resources/53.png',
'resources/54.png',
'resources/55.png',
'resources/56.png',
'resources/57.png',
'resources/58.png',
'resources/59.png',
'resources/6.png',
'resources/60.png',
'resources/61.png',
'resources/62.png',
'resources/63.png',
'resources/64.png',
'resources/65.png',
'resources/66.png',
'resources/67.png',
'resources/68.png',
'resources/69.png',
'resources/7.png',
'resources/70.png',
'resources/71.png',
'resources/72.png',
'resources/73.png',
'resources/74.png',
'resources/75.png',
'resources/76.png',
'resources/77.png',
'resources/78.png',
'resources/79.png',
'resources/8.png',
'resources/80.png',
'resources/81.png',
'resources/82.png',
'resources/83.png',
'resources/84.png',
'resources/85.png',
'resources/86.png',
'resources/87.png',
'resources/88.png',
'resources/89.png',
'resources/9.png',
'resources/90.png',
'resources/91.png',
'resources/92.png',
'resources/93.png',
'resources/94.png',
'resources/95.png',
'resources/96.png',
'resources/97.png',
'resources/98.png'      ];
      
      // we decided to define validation triplets
        var validation_triplets = [{head: 'resources/1.mp4',choice_1: 'resources/2.mp4',choice_2: 'resources/3.mp4'},
            {head: 'resources/4.mp4',choice_1: 'resources/5.mp4',choice_2:'resources/6.mp4'}];

      
      
      var check_triplets=[
            {head: 'resources/1.mp4',choice_1: 'resources/2.mp4',choice_2: 'resources/1.mp4', correct_choice: 'j'},
            {head: 'resources/4.mp4',choice_1: 'resources/4.mp4',choice_2:'resources/5.mp4', correct_choice: 'f'}];
      
   //to shuffle the array of button choices at the beginning of the experiment   
    function shuffle(array) {
        let currentIndex = array.length,  randomIndex;
        // While there remain elements to shuffle.
        while (currentIndex != 0) {
        // Pick a remaining element.
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        // And swap it with the current element.
        [array[currentIndex], array[randomIndex]] = [
        array[randomIndex], array[currentIndex]];
        }
        return array;
    }
        
    var test_stimuli = [];
    
    // to get a random item from the array
    function getRandomItems(arr) {
        var temp_array = jsPsych.randomization.sampleWithoutReplacement(arr, 2);
          arr = arr.filter(e => e !== temp_array[0]);
          arr = arr.filter(e => e !== temp_array[1]);
        return temp_array;
    }
      
      
    /* define welcome message trial */
    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);
      
      // going fullscreen
    timeline.push({
      type: jsPsychFullscreen,
      fullscreen_mode: true
    });    
         
    /* define consent trail */
    var consent = {
        type: jsPsychImageButtonResponse,
        stimulus: "kc_lab_consent_SONA.png",
        choices: ["Consent & Continue"]
    };
    timeline.push(consent);
      
      
          
    // define testing instructions 
    var instructions = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "<p>In each trial of this task, you will see three video clips of emotional expressions: one reference clip on top, and two choices beneath the reference clip." +
        "</p><p><strong>For each trial, please <u>select the clip with the facial expression closest to the expression of the face in the reference clip</u>.</strong>"+
          "<p>Click 'Continue' to begin the test.</p>",
        choices: ["Continue"],
      post_trial_gap: 2000
    };
    timeline.push(instructions);  
      
      // define fixation
      var fixation = {
          type: jsPsychHtmlKeyboardResponse,
            stimulus: '+',
            choices: "NO_KEYS",
            trial_duration: 500
        };
      timeline.push(fixation);
      
      
      var arr_pair = [];


// define the trials!
      var trial = {
          type: jsPsychVideoKeyboardResponse,
            stimulus: [jsPsych.timelineVariable('face')],    // IF YOU CHANGED THE OBJECT NAMES IN YOUR ARRAY ABOVE, CHANGE THEM HERE TO MATCH     
             prompt: function(){
                shuffle(faces_arr);
                arr_pair = getRandomItems(faces_arr);
                // Ensure that the choices and stimulus are NOT the same
                while(arr_pair[0] == jsPsych.timelineVariable('face') || arr_pair[1] == jsPsych.timelineVariable('face')){
                    arr_pair = getRandomItems(faces_arr);
                }
                // Construct HTML for the videos
                var html = '<div style="display: flex; justify-content: center;">'; // Center the videos horizontally
                html += '<video width="500" height="375" controls>';
                html += '<source src="' + arr_pair[0] + '" type="video/mp4">';
                html += 'Your browser does not support the video tag.';
                html += '</video>';
                html += '<video width="500" height="375" controls style="margin-left: 10px;">'; // Add margin between videos
                html += '<source src="' + arr_pair[1] + '" type="video/mp4">';
                html += 'Your browser does not support the video tag.';
                html += '</video>';
                html += '</div>';
                html += '<br>Which is more similar in expression to the video on top? <br><strong>Press "f" for the video on the left, or "j" for the video on the right.';
                return html;
            },
            height: 400,
            width: 500,
          controls: true,
          choices: ['f', 'j'],
            on_finish: function(data){
                shuffle(faces_arr); // CHANGE THIS TO MATCH THE REGULAR ARRAY YOU SPECIFICIED ABOVE
                data.choices = arr_pair;
                n = 1;
                var data_last1 = jsPsych.data.get().last(n);
                lasttrialdata_rt = data_last1.select('rt').mean();
                if (lasttrialdata_rt < 900){
                      data.speedy = true;
                    } else {
                      data.speedy = false; 
                }
                data.validation = false;
            }
      };
      
      
      // define the trials!
      var validation_trial = {
          type: jsPsychVideoKeyboardResponse,
            stimulus: [jsPsych.timelineVariable('head')],    // IF YOU CHANGED THE OBJECT NAMES IN YOUR ARRAY ABOVE, CHANGE THEM HERE TO MATCH     
             prompt: function(){
                arr_pair = [jsPsych.timelineVariable('choice_1'), jsPsych.timelineVariable('choice_2')];
                 
                // Construct HTML for the videos
                var html = '<div style="display: flex; justify-content: center;">'; // Center the videos horizontally
                html += '<video width="500" height="375" controls>';
                html += '<source src="' + arr_pair[0] + '" type="video/mp4">';
                html += 'Your browser does not support the video tag.';
                html += '</video>';
                html += '<video width="500" height="375" controls style="margin-left: 10px;">'; // Add margin between videos
                html += '<source src="' + arr_pair[1] + '" type="video/mp4">';
                html += 'Your browser does not support the video tag.';
                html += '</video>';
                html += '</div>';
                html += '<br>Which is more similar to the video on top? <br><strong>Press "f" for the video on the left. Press "j" for the video on the right.';
                return html;
            },
            height: 400,
            width: 500,
            controls: true,
            choices: ['f', 'j'],
            on_finish: function(data){
                shuffle(faces_arr); // CHANGE THIS TO MATCH THE REGULAR ARRAY YOU SPECIFICIED ABOVE
                data.choices = arr_pair;
                n = 1;
                var data_last1 = jsPsych.data.get().last(n);
                lasttrialdata_rt = data_last1.select('rt').mean();
                if (lasttrialdata_rt < 900){
                      data.speedy = true;
                    } else {
                      data.speedy = false; 
                }
                data.validation = false;
            }
      };
      
      
        var check_trial = {
          type: jsPsychVideoKeyboardResponse,
            stimulus: [jsPsych.timelineVariable('head')],    // IF YOU CHANGED THE OBJECT NAMES IN YOUR ARRAY ABOVE, CHANGE THEM HERE TO MATCH     
             prompt: function(){
                arr_pair = [jsPsych.timelineVariable('choice_1'), jsPsych.timelineVariable('choice_2')];
                // Construct HTML for the videos
                var html = '<div style="display: flex; justify-content: center;">'; // Center the videos horizontally
                html += '<video width="500" height="375" controls muted>';
                html += '<source src="' + arr_pair[0] + '" type="video/mp4">';
                html += 'Your browser does not support the video tag.';
                html += '</video>';
                html += '<video width="500" height="375" controls muted style="margin-left: 10px;">'; // Add margin between videos
                html += '<source src="' + arr_pair[1] + '" type="video/mp4">';
                html += 'Your browser does not support the video tag.';
                html += '</video>';
                html += '</div>';
                html += '<br>Which is more similar to the video on top? <br><strong>Press "f" for the video on the left. Press "j" for the video on the right.';
                return html;
            },
            height: 400,
            width: 500,
            controls: true,
            choices: ['f', 'j'],
            on_finish: function(data){
              data.choices = arr_pair;
              if (data.response == jsPsych.timelineVariable('correct_choice')){
                  data.correct = true;
                } else {
                  data.correct = false; 
              }
                data.validation = true;
          }
      };
      
      
      
        
        var if_trial_check = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "<p><strong>Incorrect!</strong></p>That was an attention check. Please pay attention while completing this task.<p>Press 'y' to continue.</p>",
            choices:["y"]
        }

        var if_node_check = {
            timeline: [if_trial_check],
            conditional_function: function(){
                // get the data from the previous trial,
                // and check which key was pressed
                var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
                if(last_trial_correct){
                    return false; // the parameter value has to be returned from the function
                } else {
                    return true; // the parameter value has to be returned from the function
                }
            }
        }
        
        var if_trial_speed = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "<p><strong>You're going too fast.</strong><p>Please slow down and assess each triplet." +
                  "<p>Press 'y' to continue.</p></p>",
            choices: ["y"]
        }

        var if_node_speed = {
            timeline: [if_trial_speed],
            conditional_function: function(){
                // get the data from the previous trial,
                // and check which key was pressed
                var last_trial_speed = jsPsych.data.get().last(1).values()[0].speedy;
                if(last_trial_speed){
                    return true; // the parameter value has to be returned from the function;
                } else{
                    return false;
                }
            }
        }


        // okay so this is to get a random set of elements...  
        function getRandom(arr, n) {
            var result = new Array(n),
                len = arr.length,
                taken = new Array(len);
            if (n > len)
                throw new RangeError("getRandom: more elements taken than available");
            while (n--) {
                var x = Math.floor(Math.random() * len);
                result[n] = arr[x in taken ? taken[x] : x];
                taken[x] = --len in taken ? taken[len] : len;
            }
            return result;
        }

        //actually grabbing them


    var validation_procedure = {
        timeline: [fixation, validation_trial, if_node_speed],
        timeline_variables: validation_triplets,
        sample :{
            type: 'without-replacement',
            size: 1 // CHANGE THIS if you want a different number of validation trials per block
        }
    };

    var trial_procedure = {
        timeline: [fixation, trial, if_node_speed],
        timeline_variables: faces,
        randomize_order: true,
        sample: {
            type: 'with-replacement',
            size: 1 // CHANGE THIS if you want a different number of regular trials per block
        }
    };


    var check_procedure = {
        timeline: [fixation, check_trial, if_node_check],
        timeline_variables: check_triplets,
        sample: {
            type: 'without-replacement',
            size: 1 // CHANGE THIS if you want a different number of check trials per block
        }
    };


    var block_procedure = {
        timeline: [trial_procedure, check_procedure, validation_procedure],
        randomize_order: true,
        repetitions: 1 // CHANGE THIS if you want a different number of all trials
    };

    // total number of trials = (40*5) + (10*5) + (1*5) = 255 trials

      
    var quick_break = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "Nice job! Feel free to take a quick break, then click 'Continue' when you are ready proceed to the next round." +
        "<p>Remember, your task is to <strong>select the face with the <u>facial expression</u> closest to the expression of the face on top.</strong>",
        choices: ["Continue"]
    };
      
      
      timeline.push(block_procedure);
      timeline.push(quick_break);
      timeline.push(block_procedure);
    


    // survey time
    var demographic_instructions = {
          type: jsPsychHtmlButtonResponse,
          stimulus: "<p>Awesome!<p>For this last part of the experiment, please provide us with information about yourself.</p> ",
          choices: ["Continue"],
          post_trial_gap: 1000
        };
    timeline.push(demographic_instructions);


    var demographics = {
        type: jsPsychSurveyMultiSelect,
        questions: [
          {prompt: "Which categories describe you? Select all that apply to you:", 
            options: ["American Indian or Alaska Naive - For example, Navajo Nation, Mayan", 
                      "Asian - For example, Chinese, Asian Indian",
                      "Black or African American - For example, Jamaican, Ethiopian",
                      "Hispanic or Latino - For example, Mexican or Mexican American, Puerto Rican, Salvadoran",
                     "Middle Eastern or North African - For example, Lebanese, Iranian, Moroccan",
                     "Native Hawaiian or Other Pacific Islander - For example, Somoan, Fijian",
                     "White - For example, German, Irish",
                     "Some other race, ethnicity, or origin",
                     "I prefer not to answer"], 
            horizontal: false,
            required: true,
            name: 'race_eth'}]
    };
    timeline.push(demographics);  


      
    var id_age = {
      type: jsPsychSurveyText,
      questions: [{prompt: "Please enter your age (in years):", rows: 1, columns: 6, name: "age", required: true}, 
                  {prompt: "How do you currently describe your gender identity? Please specify.", rows: 1, columns: 60, name: "gender"},
                  {prompt: "What is your ZIP code?", rows : 1, columns: 6, name: "zip"}
                 ]
    };
    timeline.push(id_age);
      
      
  timeline.push(save_data);
    
   var goodbye = {
      type: jsPsychHtmlButtonResponse,
      stimulus: function(){
        output = "Woohoo! You have finished the experiment. <br>";
          if(urlvar.workerId.length > 7){
              output = output + "<strong> Here is your secret code: " + secret_code + "</strong><br>";
          }
        output = output + "You may now close this screen. Goodbye!<br><br>";
      return output;
      },
      choices: ["Complete Experiment"]    
   };
    timeline.push(goodbye);

      
    jsPsych.run(timeline);



  </script>
  </html>

<!--

-->
